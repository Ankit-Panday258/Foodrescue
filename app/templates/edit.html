{% extends "base.html" %}
{% block title %}Edit Food Listing - Food Rescue{% endblock %}
{% block content %}

<!-- Page Header -->
<div class="page-header bg-light py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="h3 mb-0">
                    <i class="fas fa-edit text-primary"></i>
                    Edit Food Listing
                </h1>
                <p class="text-muted mb-0">Update your food listing details</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a
                    href="{{ url_for('food.showListing', id=listing.listing_id) }}"
                    class="btn btn-outline-primary"
                >
                    <i class="fas fa-arrow-left"></i>
                    Back to Listing
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Form Card -->
            <div class="card form-card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-utensils"></i>
                        Food Details
                    </h5>
                </div>
                <div class="card-body">
                    <form
                        method="POST"
                        action="{{ url_for('food.updateListing', id=listing.listing_id) }}"
                        class="needs-validation"
                        novalidate
                    >
                        <!-- Food Name -->
                        <div class="form-group mb-3">
                            <label for="food_name" class="form-label required">
                                <i class="fas fa-utensils me-2"></i>
                                Food Name
                            </label>
                            <input
                                type="text"
                                class="form-control"
                                id="food_name"
                                name="food_name"
                                value="{{ listing.food_name }}"
                                required
                                maxlength="100"
                                placeholder="e.g., Fresh Tomatoes, Homemade Pasta"
                            />
                            <div class="invalid-feedback">
                                Please provide a valid food name.
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-group mb-3">
                            <label for="description" class="form-label required">
                                <i class="fas fa-info-circle me-2"></i>
                                Description
                            </label>
                            <textarea
                                class="form-control"
                                id="description"
                                name="description"
                                rows="4"
                                required
                                maxlength="500"
                                placeholder="Describe the food item, its condition, and any special instructions"
                            >{{ listing.description }}</textarea>
                            <div class="form-text">
                                <span class="char-count">0/500 characters</span>
                            </div>
                            <div class="invalid-feedback">
                                Please provide a description.
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="form-group mb-3">
                            <label for="location" class="form-label required">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Pickup Location
                            </label>
                            <input
                                type="text"
                                class="form-control"
                                id="location"
                                name="location"
                                value="{{ listing.location }}"
                                required
                                maxlength="200"
                                placeholder="e.g., 123 Main St, City Center, Near Bus Stop"
                            />
                            <div class="form-text">
                                Provide a clear location for pickup
                            </div>
                            <div class="invalid-feedback">
                                Please provide a pickup location.
                            </div>
                        </div>

                        <!-- Expiry Date -->
                        <div class="form-group mb-3">
                            <label for="expiry_date" class="form-label required">
                                <i class="fas fa-calendar-alt me-2"></i>
                                Expiry Date
                            </label>
                            <input
                                type="date"
                                class="form-control"
                                id="expiry_date"
                                name="expiry_date"
                                value="{{ listing.expiry_date.strftime('%Y-%m-%d') if listing.expiry_date else '' }}"
                                required
                            />
                            <div class="form-text">
                                When does this food expire or need to be consumed by?
                            </div>
                            <div class="invalid-feedback">
                                Please provide a valid expiry date.
                            </div>
                        </div>

                        <!-- Food Type -->
                        <div class="form-group mb-3">
                            <label for="food_type" class="form-label required">
                                <i class="fas fa-tag me-2"></i>
                                Food Type
                            </label>
                            <select
                                class="form-select"
                                id="food_type"
                                name="food_type"
                                required
                            >
                                <option value="">Select food type</option>
                                <option value="fruits" {% if listing.food_type == "fruits" %}selected{% endif %}>
                                    Fruits
                                </option>
                                <option value="vegetables" {% if listing.food_type == "vegetables" %}selected{% endif %}>
                                    Vegetables
                                </option>
                                <option value="dairy" {% if listing.food_type == "dairy" %}selected{% endif %}>
                                    Dairy
                                </option>
                                <option value="meat" {% if listing.food_type == "meat" %}selected{% endif %}>
                                    Meat
                                </option>
                                <option value="grains" {% if listing.food_type == "grains" %}selected{% endif %}>
                                    Grains
                                </option>
                                <option value="prepared" {% if listing.food_type == "prepared" %}selected{% endif %}>
                                    Prepared Food
                                </option>
                                <option value="baked" {% if listing.food_type == "baked" %}selected{% endif %}>
                                    Baked Goods
                                </option>
                                <option value="beverages" {% if listing.food_type == "beverages" %}selected{% endif %}>
                                    Beverages
                                </option>
                                <option value="other" {% if listing.food_type == "other" %}selected{% endif %}>
                                    Other
                                </option>
                            </select>
                            <div class="invalid-feedback">
                                Please select a food type.
                            </div>
                        </div>

                        <!-- Image URL -->
                        <div class="form-group mb-3">
                            <label for="image_url" class="form-label">
                                <i class="fas fa-image me-2"></i>
                                Image URL (Optional)
                            </label>
                            <input
                                type="url"
                                class="form-control"
                                id="image_url"
                                name="image_url"
                                value="{{ listing.image_url or '' }}"
                                placeholder="https://example.com/image.jpg"
                            />
                            <div class="form-text">
                                Add a photo URL to help others see your food item
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions d-flex gap-2 justify-content-end">
                            <a
                                href="{{ url_for('food.showListing', id=listing.listing_id) }}"
                                class="btn btn-secondary"
                            >
                                <i class="fas fa-times"></i>
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Update Listing
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Help Section -->
        <div class="col-lg-4">
            <div class="card help-section">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb"></i>
                        Editing Tips
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="tips-list">
                        <li>Update information if pickup location has changed</li>
                        <li>Adjust expiry date if needed</li>
                        <li>Add more details to attract recipients</li>
                        <li>Update food condition if it has changed</li>
                        <li>Consider adding photos for better visibility</li>
                    </ul>
                </div>
            </div>

            <!-- Safety Guidelines -->
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-shield-alt"></i>
                        Safety Guidelines
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="safety-tips">
                        <li>Only share food that's safe to consume</li>
                        <li>Be honest about expiry dates</li>
                        <li>Follow food safety standards</li>
                        <li>Communicate any allergen information</li>
                        <li>Meet in safe, public locations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Form Styling */
    .form-card {
        border: none;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
    }

    .form-card .card-header {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        border-radius: 10px 10px 0 0;
        padding: 1rem 1.5rem;
        border-bottom: none;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        font-weight: 500;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .form-label.required::after {
        content: " *";
        color: #dc3545;
    }

    .form-label i {
        color: #28a745;
        width: 16px;
    }

    .form-control,
    .form-select {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 0.75rem;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }

    .form-control.is-invalid {
        border-color: #dc3545;
    }

    .form-control.is-valid {
        border-color: #28a745;
    }

    .form-text {
        color: #6c757d;
        font-size: 0.875rem;
    }

    .char-count {
        float: right;
        font-size: 0.8rem;
    }

    .form-actions {
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #e9ecef;
    }

    .form-actions .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
    }

    .help-section {
        position: sticky;
        top: 20px;
    }

    .tips-list,
    .safety-tips {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tips-list li,
    .safety-tips li {
        padding: 0.5rem 0;
        border-bottom: 1px solid #f8f9fa;
        position: relative;
        padding-left: 1.5rem;
    }

    .tips-list li:before {
        content: "✓";
        color: #28a745;
        font-weight: bold;
        position: absolute;
        left: 0;
    }

    .safety-tips li:before {
        content: "⚠";
        color: #ffc107;
        font-weight: bold;
        position: absolute;
        left: 0;
    }

    .tips-list li:last-child,
    .safety-tips li:last-child {
        border-bottom: none;
    }

    @media (max-width: 991.98px) {
        .help-section {
            position: static;
            margin-top: 2rem;
        }
    }

    @media (max-width: 768px) {
        .form-actions {
            flex-direction: column;
        }

        .form-actions .btn {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .page-header .row {
            text-align: center;
        }

        .page-header .col-md-4 {
            margin-top: 1rem;
        }
    }
</style>

<script>
    // Character counter for description
    document.addEventListener("DOMContentLoaded", function () {
        const description = document.getElementById("description");
        const charCount = document.querySelector(".char-count");

        if (description && charCount) {
            function updateCharCount() {
                const count = description.value.length;
                charCount.textContent = `${count}/500 characters`;

                if (count > 450) {
                    charCount.style.color = "#dc3545";
                } else if (count > 400) {
                    charCount.style.color = "#ffc107";
                } else {
                    charCount.style.color = "#6c757d";
                }
            }

            updateCharCount();
            description.addEventListener("input", updateCharCount);
        }

        // Form validation
        const form = document.querySelector(".needs-validation");
        if (form) {
            form.addEventListener("submit", function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add("was-validated");
            });
        }

        // Set minimum date to today
        const expiryDate = document.getElementById("expiry_date");
        if (expiryDate) {
            const today = new Date().toISOString().split("T")[0];
            expiryDate.setAttribute("min", today);
        }
    });
</script>

{% endblock %}
